/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */
// Standard
  plugins {
    id "com.moowork.node" version "1.3.1"
  }

  repositories {
    mavenLocal()
    jcenter()
  }

  /*
  node {
    download = true
    version = '9.7.0'
  }
   */

  npmInstall.inputs.files('package.json', 'package-lock.json')
  npmInstall.outputs.file('package-lock.json')
  task npmClean(type: Delete) {
    delete 'node_modules'
  }

task clean(type: Delete) {
  delete './bin', './ensureTargetOutputPath.js', './index.js', 'test/build', 'test/output'
}


task compile(type: NpmTask) {
  args = ['run', 'compile']
}
compile.inputs.file('package.json')
compile.inputs.dir('src')
compile.outputs.dir('./bin')
compile.outputs.files('./ensureTargetOutputPath.js', './index.js')

// Standard
  compile.dependsOn += npmInstall
  task build {}

build.dependsOn += compile




task lint(type: NpmTask) {
  args=['run', 'lint']
}
lint.inputs.file('package.json')
lint.inputs.dir('src')
lint.dependsOn += npmInstall

task test(type: NpmTask) {
  args=['run', 'test:mocha']
}
test.inputs.files('package.json', 'test/buildconstants_spec.js', 'test_helper.js')
test.inputs.dir('src')
test.outputs.dir('test/build')
test.outputs.dir('test/output')

// Standard:
  test.dependsOn += lint
  test.dependsOn += build



// Standard
  task doPublish(type: NpmTask) {
    args=['publish', '--dry-run']
  }
  doPublish.dependsOn += test
  task postPublish(type: NpmTask) {
    args=['run', 'clean']
  }
  postPublish.dependsOn += doPublish
  task publish {}
  publish.dependsOn += postPublish


// Standard
  task makeLink(type: NpmTask) {
    args=['link']
  }
  makeLink.dependsOn += compile
